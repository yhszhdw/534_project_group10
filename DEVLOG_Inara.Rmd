---
title: "Inara - Development Log (since 2026-01-20)"
author: "Inara"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output: html_document
---

## Project focus
- Personal scope: `boc_utils` data-quality helpers, FX close alignment, risk metrics/plots, and the visualization vignette.
- Stack: R, testthat, ggplot2, dplyr, lubridate.
- Log covers **only my work**; team commits are intentionally omitted.
- Structure mirrors teammates' devlogs: reverse-chronological entries with commit IDs, work notes, outcomes, and impact.

## Validation & next steps
- Last validation: `devtools::test()` on `boc_utils` (2026-02-02) â€” all tests pass; runtime ~3s, no skips.
- Knit check: `bocvaletR-data-visualization.Rmd` renders locally (2026-02-02) using html_vignette defaults.
- Upcoming: run full `devtools::check()` before any CRAN-style resubmission; add one example to `risk_plot_var_cvar()` Rd linking to the vignette.

## Timeline

### 2026-02-02 - Visualization vignette
#### Commits
- `a0efb3f` updated and added `bocvaletR/vignettes/bocvaletR-data-visualization.Rmd`.

#### Work completed
- Authored a full vignette walking through `boc_plot()` usage for single and multi-series data (concat tibble vs named list).
- Documented plotting modes (`auto`, `overlay`, `facet`, `separate`) plus label/legend controls, legend toggles, and missing-value handling hooks.
- Added end-to-end examples for FX series retrieval with `boc_series()`, including `concat = FALSE` flows that return a named list.
- Wrote a short risk section that reuses `risk_plot_var_cvar()` and shows how to layer titles/labels for publishable figures.
- Ensured the vignette keeps HTML_vignette defaults (toc + depth 4) and uses inline code chunks to stay runnable without pre-built artifacts.

#### Notes
- Kept plot styling minimal (theme_minimal, steelblue/darkred) to align with CRAN-friendly defaults while remaining editable by users.
- Avoided embedding images in git; plots are generated on render to keep repo clean.
- Local knit check: verified chunk order, code fences, and section anchors render correctly in VS Code preview.

#### Outcome
- Visualization layer now has user-facing guidance that is publish-ready.

#### Classification
- Type: Documentation / Examples  
- Stage: Feature completion  
- Impact: High

---

### 2026-01-31 - boc_utils regression tests
#### Commits
- `5aad9e7` test: fix `boc_utils` and add unit tests.

#### Work completed
- Added `tests/testthat/test-boc-utils.R` covering: validation helpers, `safe_exec`, FX close alignment, normalization modes, missing-value filling, summary stats, percent change, rolling mean, autocorrelation, and pairwise correlations.
- Structured tests by feature block with descriptive contexts to make future failures actionable.
- Added negative-path assertions (bad types, missing columns, invalid windows/periods) to harden error messaging.
- Tweaked `boc_utils.R` for edge cases surfaced by tests (e.g., single-value windows, non-numeric columns, insufficient non-NA points).

#### Outcome
- Established a regression harness for all utility functions, protecting later refactors.

#### Notes
- Synthetic fixtures keep tests deterministic (e.g., controlled POSIXct examples for FX close alignment).
- Tests are pure-R (no network) so they remain fast and CI-safe.

#### Classification
- Type: Testing / Hardening  
- Stage: Stabilization  
- Impact: High

---

### 2026-01-30 - Risk metrics and visuals
#### Commits
- `37029ab` change summary: add `risk_var_cvar` function and related documentation.

#### Work completed
- Implemented `risk_var_cvar()` (historical VaR/CVaR with strict validation on `x`, `alpha`, and minimum sample size).
- Added `risk_plot_var_cvar()` (histogram + density with VaR/CVaR markers and tail rug) and `risk_text_summary()` helper.
- Registered functions in `NAMESPACE`, added Rd docs and sample plot asset, and wired them into the full demo vignette.
- Chose dashed red for VaR and solid dark red for CVaR to make risk thresholds visually distinct.
- Guarded against degenerate inputs (all NA, non-numeric, or alpha outside (0,1)) to prevent silent misreports.

#### Outcome
- Package now exposes reusable risk analytics and matching visual outputs for FX return series.

#### Notes
- Plot scales use relative frequency (not counts) to keep visuals comparable across sample sizes.
- Left tail rug is limited to `ret <= VaR` to focus interpretation on exceedance events.

#### Classification
- Type: Feature development  
- Stage: Feature completion  
- Impact: High

---

### 2026-01-29 - Data-quality utilities and documentation
#### Commits
- `64e09f9` added exception for bocvaletR directory for `boc_utils`.

#### Work completed
- Expanded `boc_utils.R` with validation helpers, `safe_exec`, missing-value fillers (LOCF/NOCB/linear), normalization (`zscore`/`minmax`/`index`), percent-change and rolling-mean calculators, autocorrelation/correlation tables, grouped summaries, and FX close alignment.
- Added roxygen docs (e.g., `boc_align_fx_close.Rd`), updated `NAMESPACE`, `.Rbuildignore`, `DESCRIPTION`, `README`, and `zzz.R` to expose the new utilities.
- Created this devlog file to track my contributions going forward.
- Time-zone handling: `boc_align_fx_close()` now coerces character timestamps via `input_tz`, then buckets by `cutoff_hour/min` in `cutoff_tz` using `lubridate::with_tz`.
- Normalization functions use per-series grouping; index mode leverages `first_non_na()` to set a stable base even with leading NAs.

#### Outcome
- Robust time-series utility layer in place to support downstream risk and visualization work.

#### Notes
- Error messages routed through `rlang::abort()` for consistent, user-friendly output.
- Added `.Rbuildignore` entry to prevent dev-only artifacts from leaking into builds.

#### Classification
- Type: Feature development / Documentation  
- Stage: In progress  
- Impact: High

---

### 2026-01-24 - Initial boc_utils build
#### Commits
- `94eebb9` added 4.3 part of `boc_utils.R`.

#### Work completed
- Bootstrapped the initial set of time-series helpers: first non-missing value detection, LOCF/NOCB filling, linear interpolation, and early validation scaffolding for numeric series.
- Established helper layout and naming conventions that later functions reuse (validate_* + fill_* + summarize_* pattern).

#### Outcome
- Established the baseline structure for later data-quality and alignment functions.

#### Notes
- Focused on clear, side-effect-free helpers to keep later unit testing straightforward.

#### Classification
- Type: Feature development  
- Stage: Initial implementation  
- Impact: Medium

---

### 2026-01-22 to 2026-01-23 - Local research (no commits)
#### Work completed
- Reviewed dplyr grouped-mutate behaviors and common NA pitfalls for time-series data.
- Explored sample FX series to test normalization and date alignment ideas prior to coding.
- Compared LOCF vs linear interpolation trade-offs for sparse FX series; chose to ship all three methods with explicit semantics.
- Sketched expected outputs for autocorr/correlation helpers to ensure consistent column naming (`series`, `lag`, `acf`).

#### Outcome
- Informed the design of `boc_align_fx_close`, normalization choices, and missing-data strategies.

#### Notes
- Decided to keep functions data.frame/tibble-friendly instead of requiring ts/xts to minimize dependencies.

---

### 2026-01-20 - Project onboarding
#### Work completed
- Set up VS Code environment and began scoping `boc_utils` requirements for the Valet API workflows.
- Drafted a minimal checklist for utilities needed by downstream plotting and risk analysis (fill, normalize, percent change, rolling stats).

#### Notes
- Confirmed Bank of Canada Valet API series IDs and time-zone conventions to avoid later surprises in FX alignment.
